void processData(void *parameter) {
  // char localBuffer[BIG_BUFFER_SIZE];
  localBuffer = (char *)malloc(BIG_BUFFER_SIZE * sizeof(char));

  int localBufferIndex = 0;
  char ch;

  while (true) {
    if (commState == COMM_ESP32) {
      handleESP32Config(localBuffer, localBufferIndex, serialBuffer, bufferIndex);
    } else {
      while (g_mescSerial->available()) {
	char incomingByte = g_mescSerial->read();
	if (bufferIndex < BIG_BUFFER_SIZE - 1) {
	  g_compSerial->println(bufferIndex);
	  serialBuffer[bufferIndex++] = incomingByte;
	  serialBuffer[bufferIndex] = '\0';
	}
      }

      if (bufferIndex > 0) {
	g_compSerial->println("concatencating");
	memcat(localBuffer, localBufferIndex, serialBuffer, bufferIndex);
	localBufferIndex += bufferIndex;
	bufferIndex = 0;
	serialBuffer[bufferIndex] = '\0';
	lastReceiveTime = millis();
      }

      for (int i = 0; i < localBufferIndex; i++) {
	if (localBuffer[i] == '\n') {
	  localBuffer[i] = '\0';
	  processLine(localBuffer);
	  int remainingLength = localBufferIndex - (i + 1);
	  memmove(localBuffer, localBuffer + i + 1, remainingLength);
	  localBufferIndex = remainingLength;
	  i = -1;
	}
      }

      if (localBufferIndex > 0 && (millis() - lastReceiveTime) >= SERIAL_TIMEOUT_MS) {
	localBuffer[localBufferIndex] = '\0';
	localBufferIndex = 0;

	if (commState == COMM_GET || commState == COMM_IDLE) {
	  String jsonString; 
	  serializeJson(jsonDoc, jsonString);
	  Serial.println(jsonString);
	  g_webSocket->textAll(jsonString);
	  jsonDoc.clear();
	}
	commState = COMM_IDLE;
      }

      while (g_compSerial->available()) {
	ch = g_compSerial->read();
	g_mescSerial->write(ch);
	g_compSerial->write(ch);
	if (ch == '>') {
	  bufferIndex = 0;
	  localBufferIndex = 0;
	  initESP32Config();
	}
      }
    }
    vTaskDelay(1 / portTICK_PERIOD_MS);
  }
}


{"time":[0.000000,0.000050,0.000100,0.000150,0.000200,0.000250,0.000300,0.000350,0.000400,0.000450,0.000500,0.000550,0.000600,0.000650,0.000700,0.000750,0.000800,0.000850,0.000900,0.000950,0.001000,0.001050,0.001100,0.001150,0.001200,0.001250,0.001300,0.001350,0.001400,0.001450,0.001500,0.001550,0.001600,0.001650,0.001700,0.001750,0.001800,0.001850,0.001900,0.001950,0.002000,0.002050,0.002100,0.002150,0.002200,0.002250,0.002300,0.002350,0.002400,0.002450,0.002500,0.002550,0.002600,0.002650,0.002700,0.002750,0.002800,0.002850,0.002900,0.002950,0.003000,0.003050,0.003100,0.003150,0.003200,0.003250,0.003300,0.003350,0.003400,0.003450,0.003500,0.003550,0.003600,0.003650,0.003700,0.003750,0.003800,0.003850,0.003900,0.003950,0.004000,0.004050,0.004100,0.004150,0.004200,0.004250,0.004300,0.004350,0.004400,0.004450,0.004500,0.004550,0.004600,0.004650,0.004700,0.004750,0.004800,0.004850,0.004900,0.004950],"Vbus.V.y1":[54.49,54.53,54.61,54.57,54.57,54.53,54.57,54.53,54.57,54.57,54.57,54.61,54.61,54.57,54.53,54.53,54.61,54.57,54.53,54.53,54.38,54.57,54.57,54.53,54.53,54.57,54.57,54.61,54.61,54.53,54.53,54.53,54.57,54.53,54.49,54.57,54.53,54.53,54.57,54.49,54.53,54.53,54.53,54.57,54.53,54.53,54.57,54.53,54.53,54.57,54.57,54.57,54.57,54.57,54.57,54.57,54.53,54.57,54.61,54.53,54.53,54.53,54.49,54.53,54.42,54.57,54.42,54.57,54.53,54.53,54.57,54.53,54.57,54.53,54.57,54.49,54.57,54.53,54.57,54.53,54.57,54.57,54.57,54.64,54.53,54.57,54.61,54.53,54.53,54.49,54.57,54.53,54.53,54.57,54.53,54.57,54.57,54.53,54.57,54.53],"Iu.I_phase.y1":[0.48,-0.22,-0.22,-0.45,-0.45,0.48,0.25,-0.45,0.48,-0.22,0.01,-0.22,-0.45,0.25,-0.22,0.01,0.01,-0.22,0.25,-0.22,-0.22,-0.45,-0.45,0.25,-0.45,0.01,1.18,0.48,0.48,0.25,-0.22,0.48,0.01,-0.22,-0.22,0.71,-0.22,0.01,-0.68,0.01,0.48,-0.45,0.01,-0.92,-0.22,-0.45,-0.22,0.01,-0.45,-0.22,0.25,0.25,-0.22,0.48,-0.45,-0.22,-0.45,-0.22,0.25,0.25,0.48,-0.22,-0.22,0.25,-0.22,0.01,-0.22,0.01,0.25,-0.22,-0.22,-0.45,-0.22,0.01,-0.45,-0.22,0.01,-0.22,-0.22,0.71,0.01,-0.45,-0.22,0.71,0.01,-0.22,-0.22,-0.22,-0.45,0.25,-0.22,-0.22,-0.45,-0.22,-0.22,-0.22,0.25,-0.22,0.25,-0.45],"Iv.I_phase.y1":[0.13,-0.34,-0.10,-0.34,-0.10,0.13,0.13,-0.57,0.36,-0.57,-0.10,-0.34,-0.10,0.36,-0.57,0.13,-0.34,-0.34,0.36,-0.34,-0.34,-0.34,-0.10,-0.34,-0.10,0.13,0.83,0.36,0.36,0.13,-0.34,0.36,-0.57,-0.34,-0.10,0.36,-0.34,-0.10,-0.80,-0.10,0.36,-0.80,-0.10,-1.27,-0.34,-0.10,-0.10,-0.10,-0.10,-0.10,0.36,0.36,-0.34,0.36,-0.57,-0.10,-0.57,-0.57,0.13,0.36,0.36,-0.10,-0.57,-0.34,0.36,-0.10,-0.10,-0.10,-0.10,-0.10,-0.10,-0.57,-0.34,-0.10,-0.10,-0.10,-0.10,-0.10,-0.10,0.59,-0.10,-0.10,-0.10,0.36,-0.10,-0.10,-0.10,-0.57,-0.34,0.36,-0.10,-0.10,-0.57,-0.10,-0.10,-0.34,0.13,-0.10,0.13,-0.57],"Iw.I_phase.y1":[0.47,-0.23,-0.46,-0.23,-0.46,0.23,0.23,-0.23,0.47,-0.23,-0.23,-0.23,-0.23,0.47,-0.23,0.23,-0.23,-0.23,0.24,0.00,0.00,-0.46,-0.23,-0.23,-0.23,-0.23,1.17,0.70,0.23,0.47,-0.23,0.47,0.00,-0.23,0.00,0.47,-0.23,0.00,-0.46,-0.23,0.47,-0.23,-0.23,-0.46,-0.23,-0.23,-0.23,-0.23,-0.46,0.00,0.24,0.00,-0.23,0.24,-0.23,-0.23,-0.23,-0.23,0.47,0.70,0.47,-0.23,-0.46,-0.23,0.24,-0.23,-0.46,0.00,-0.23,-0.23,-0.23,-0.23,-0.46,-0.23,-0.23,-0.46,-0.46,-0.46,-0.23,0.70,0.24,-0.23,-0.46,0.24,-0.23,-0.23,0.00,-0.23,-0.23,0.24,0.00,-0.23,-0.23,-0.23,0.00,-0.23,0.47,0.00,0.24,-0.23],"Vd.V_dq.y1":[0.05,0.00,0.00,0.03,0.02,0.01,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,-0.01,0.02,0.01,0.03,0.00,0.03,0.07,0.02,0.03,0.00,0.02,0.00,0.00,0.01,0.02,0.02,0.02,0.00,0.02,0.03,0.02,0.00,0.01,0.01,0.03,0.07,0.02,0.02,0.02,0.02,0.01,-0.01,0.04,0.01,0.02,0.01,0.02,0.01,0.02,0.02,0.04,0.00,0.01,0.02,0.05,0.04,0.03,0.02,-0.00,0.05,0.03,0.02,0.01,0.03,0.00,-0.01,0.02,0.01,0.02,0.03,0.05,0.02,0.03,-0.01,0.03,0.02,0.00,-0.01,0.02,0.02,0.03,0.02,0.02,0.02,0.03,0.02,0.02,0.02,0.02,0.00,0.03,0.04],"Vq.V_dq.y1":[-0.04,0.00,0.00,-0.03,-0.01,-0.02,-0.01,-0.01,0.02,-0.01,0.02,0.02,-0.01,0.02,0.02,0.02,0.02,0.02,0.02,-0.01,-0.05,-0.03,0.00,-0.03,-0.08,-0.01,-0.03,0.00,-0.01,0.00,0.00,-0.02,-0.01,-0.01,-0.01,0.00,0.02,-0.03,-0.01,0.00,-0.05,-0.05,-0.03,-0.08,-0.01,0.02,0.02,-0.01,-0.02,0.05,0.01,-0.02,0.02,-0.02,-0.01,-0.05,-0.01,-0.01,0.01,0.00,-0.05,-0.01,-0.01,-0.05,-0.03,-0.01,0.09,-0.01,-0.03,-0.01,-0.02,-0.03,0.00,0.02,-0.01,-0.02,0.02,-0.03,-0.01,-0.01,-0.03,0.02,-0.03,-0.01,0.00,0.05,-0.01,-0.01,-0.03,0.02,-0.01,-0.01,-0.03,0.02,-0.01,0.02,-0.01,0.00,-0.03,0.01],"angle.misc.y1":[57331,57331,57286,57291,57331,57319,57290,57286,57333,57287,57293,57290,57292,57332,57288,57320,57293,57292,57324,57305,57302,57339,57333,57292,57328,57299,57358,57269,57319,57329,57290,57331,57325,57291,57304,57333,57292,57304,57372,57297,57334,57361,57312,57400,57334,57340,57304,57303,57289,57328,57332,57320,57340,57334,57365,57306,57365,57302,57303,57362,57351,57336,57357,57305,57316,57321,57298,57319,57306,57332,57305,57362,57341,57308,57307,57294,57320,57291,57328,57356,57322,57339,57290,57283,57315,57316,57326,57308,57308,57299,57320,57309,57300,57333,57318,57304,57347,57319,57332,57367]}